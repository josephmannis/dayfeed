{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = require(\"react\");\n\nfunction fromStorage(value) {\n  return value !== null ? JSON.parse(value) : null;\n}\n\nfunction readItem(storage, key) {\n  try {\n    var storedValue = storage.getItem(key);\n    return fromStorage(storedValue);\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction toStorage(value) {\n  return JSON.stringify(value);\n}\n\nfunction writeItem(storage, key, value) {\n  try {\n    if (value !== null) {\n      storage.setItem(key, toStorage(value));\n    } else {\n      storage.removeItem(key);\n    }\n\n    return Promise.resolve();\n  } catch (error) {\n    return Promise.reject(error);\n  }\n}\n\nfunction useInitialState(storage, key, defaultState) {\n  var defaultStateRef = react_1.useRef(defaultState);\n  return react_1.useMemo(function () {\n    var _a;\n\n    return (_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current;\n  }, [key, storage]);\n}\n\nexports.useInitialState = useInitialState;\n\nfunction useStorageWriter(storage, key, state) {\n  var _a = react_1.useState(undefined),\n      writeError = _a[0],\n      setWriteError = _a[1];\n\n  react_1.useEffect(function () {\n    writeItem(storage, key, state).catch(function (error) {\n      if (!error || !error.message || error.message !== (writeError === null || writeError === void 0 ? void 0 : writeError.message)) {\n        setWriteError(error);\n      }\n    });\n\n    if (writeError) {\n      return function () {\n        setWriteError(undefined);\n      };\n    }\n  }, [state, key, writeError, storage]);\n  return writeError;\n}\n\nexports.useStorageWriter = useStorageWriter;\n\nfunction useStorageListener(storage, key, defaultState, onChange) {\n  var defaultStateRef = react_1.useRef(defaultState);\n  var onChangeRef = react_1.useRef(onChange);\n  var firstRun = react_1.useRef(true);\n  react_1.useEffect(function () {\n    var _a;\n\n    if (firstRun.current) {\n      firstRun.current = false;\n      return;\n    }\n\n    onChangeRef.current((_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n  }, [key, storage]);\n  react_1.useEffect(function () {\n    function onStorageChange(event) {\n      var _a;\n\n      if (event.key === key) {\n        onChangeRef.current((_a = fromStorage(event.newValue)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n      }\n    }\n\n    if (typeof window !== 'undefined') {\n      window.addEventListener('storage', onStorageChange);\n      return function () {\n        window.removeEventListener('storage', onStorageChange);\n      };\n    }\n  }, [key]);\n}\n\nexports.useStorageListener = useStorageListener;","map":{"version":3,"sources":["../src/common.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_1 = require(\"react\");\nfunction fromStorage(value) {\n    return value !== null ? JSON.parse(value) : null;\n}\nfunction readItem(storage, key) {\n    try {\n        var storedValue = storage.getItem(key);\n        return fromStorage(storedValue);\n    }\n    catch (e) {\n        return null;\n    }\n}\nfunction toStorage(value) {\n    return JSON.stringify(value);\n}\nfunction writeItem(storage, key, value) {\n    try {\n        if (value !== null) {\n            storage.setItem(key, toStorage(value));\n        }\n        else {\n            storage.removeItem(key);\n        }\n        return Promise.resolve();\n    }\n    catch (error) {\n        return Promise.reject(error);\n    }\n}\nfunction useInitialState(storage, key, defaultState) {\n    var defaultStateRef = react_1.useRef(defaultState);\n    return react_1.useMemo(function () { var _a; return (_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current; }, [\n        key,\n        storage,\n    ]);\n}\nexports.useInitialState = useInitialState;\nfunction useStorageWriter(storage, key, state) {\n    var _a = react_1.useState(undefined), writeError = _a[0], setWriteError = _a[1];\n    react_1.useEffect(function () {\n        writeItem(storage, key, state).catch(function (error) {\n            if (!error || !error.message || error.message !== (writeError === null || writeError === void 0 ? void 0 : writeError.message)) {\n                setWriteError(error);\n            }\n        });\n        if (writeError) {\n            return function () {\n                setWriteError(undefined);\n            };\n        }\n    }, [state, key, writeError, storage]);\n    return writeError;\n}\nexports.useStorageWriter = useStorageWriter;\nfunction useStorageListener(storage, key, defaultState, onChange) {\n    var defaultStateRef = react_1.useRef(defaultState);\n    var onChangeRef = react_1.useRef(onChange);\n    var firstRun = react_1.useRef(true);\n    react_1.useEffect(function () {\n        var _a;\n        if (firstRun.current) {\n            firstRun.current = false;\n            return;\n        }\n        onChangeRef.current((_a = readItem(storage, key)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n    }, [key, storage]);\n    react_1.useEffect(function () {\n        function onStorageChange(event) {\n            var _a;\n            if (event.key === key) {\n                onChangeRef.current((_a = fromStorage(event.newValue)) !== null && _a !== void 0 ? _a : defaultStateRef.current);\n            }\n        }\n        if (typeof window !== 'undefined') {\n            window.addEventListener('storage', onStorageChange);\n            return function () {\n                window.removeEventListener('storage', onStorageChange);\n            };\n        }\n    }, [key]);\n}\nexports.useStorageListener = useStorageListener;\n//# sourceMappingURL=common.js.map"]},"metadata":{},"sourceType":"script"}