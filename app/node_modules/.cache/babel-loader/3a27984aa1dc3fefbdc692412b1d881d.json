{"ast":null,"code":"var getBaseUrl=function getBaseUrl(loc){return\"https://newsapi.org/v2/\".concat(loc,\"?\");};var defualtHeadlineCountry='us';var CACHE_TIME=3.6e+6;// 1 hour\nexport default function getNewsService(){return{getSources:getSources,searchAllArticles:searchAllArticles,searchTopHeadlines:searchTopHeadlines};}function getSources(category,language,country){var url=getBaseUrl('sources');url=\"\".concat(url).concat(category?\"&category=\".concat(category):'').concat(language?\"&language=\".concat(language):'').concat(country?\"&country=\".concat(country):'');return cachedFetch(url).then(function(res){return res.json();}).then(function(res){return res.sources;}).catch(function(error){return error;});}function searchAllArticles(query,pageSize,page,sortOrder){var url=getBaseUrl('everything');url=\"\".concat(url).concat(getKeywordString(query));return cachedFetch(url).then(function(res){return res.json();}).then(function(articles){return articles;}).catch(function(error){console.log(error);throw error;});}function searchTopHeadlines(query,pageSize,page){var category=query.category,language=query.language,country=query.country,sources=query.sources;var url=getBaseUrl('top-headlines');if(sources.length>0){url=\"\".concat(url,\"&sources=\").concat(sources.join(','));}else{url=\"\".concat(url).concat(category?\"&category=\".concat(category):'',\"&country=\").concat(country?country:defualtHeadlineCountry);}url=\"\".concat(url).concat(language?\"&language=\".concat(language):'');url=\"\".concat(url).concat(getKeywordString(query));url=url.replace('&','');return cachedFetch(url).then(function(res){return res.json();}).then(function(sources){return sources;}).catch(function(error){return error;});}function getKeywordString(query){var requiredKeywords=query.requiredKeywords.join('AND');var optionalKeywords=query.optionalKeywords.join('OR');var excludedKeywords=query.excludedKeywords.join('NOT');if(requiredKeywords===''&&optionalKeywords===''&&excludedKeywords==='')return'';return encodeURI(\"&q=\".concat(requiredKeywords).concat(optionalKeywords).concat(excludedKeywords));}function cachedFetch(url){var cached=checkCache(url);if(cached)return Promise.resolve(cached);return fetch(url,{headers:{'Authorization':\"Bearer \".concat(process.env.REACT_APP_NEWSAPI_KEY)}}).then(function(res){if(res.ok)cacheRequest(url,res);return res;});}function checkCache(url){var cached=localStorage.getItem(url);if(cached){var parsed=JSON.parse(cached);if(new Date().getTime()>parsed.expiry){localStorage.removeItem(url);}else{return new Response(new Blob([parsed.response]));}}return undefined;}function cacheRequest(url,response){response.clone().text().then(function(data){var responseData={response:data,expiry:new Date().getTime()+CACHE_TIME};localStorage.setItem(url,JSON.stringify(responseData));});}","map":{"version":3,"sources":["/home/snuc/dev/presentable-projects/dayfeed/app/src/api/news/index.ts"],"names":["getBaseUrl","loc","defualtHeadlineCountry","CACHE_TIME","getNewsService","getSources","searchAllArticles","searchTopHeadlines","category","language","country","url","cachedFetch","then","res","json","sources","catch","error","query","pageSize","page","sortOrder","getKeywordString","articles","console","log","length","join","replace","requiredKeywords","optionalKeywords","excludedKeywords","encodeURI","cached","checkCache","Promise","resolve","fetch","headers","process","env","REACT_APP_NEWSAPI_KEY","ok","cacheRequest","localStorage","getItem","parsed","JSON","parse","Date","getTime","expiry","removeItem","Response","Blob","response","undefined","clone","text","data","responseData","setItem","stringify"],"mappings":"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","sourcesContent":["import { Category, Language, SourceCountry, Source, SortOrder, NewsQuery, HeadlineQuery, HeadlineCountry, ArticleResponse, CachedRequest } from \"../../lib/api/types\";\n\ntype location = 'top-headlines' | 'everything' | 'sources';\n\nconst getBaseUrl = (loc: location) => `https://newsapi.org/v2/${loc}?`\nconst defualtHeadlineCountry: HeadlineCountry = 'us'\nconst CACHE_TIME = 3.6e+6 // 1 hour\n\nexport interface INewsService {\n    getSources: (category?: Category, language?: Language, country?: SourceCountry) => Promise<Source[]>\n    searchAllArticles: (query: NewsQuery, pageSize: number, page: number, sortOrder?: SortOrder) => Promise<ArticleResponse>\n    searchTopHeadlines: (query: HeadlineQuery, pageSize: number, page: number) => Promise<ArticleResponse>\n}\n\nexport default function getNewsService(): INewsService {\n    return {\n        getSources: getSources,\n        searchAllArticles: searchAllArticles,\n        searchTopHeadlines: searchTopHeadlines\n    }\n}\n\nfunction getSources(category?: Category, language?: Language, country?: SourceCountry): Promise<Source[]> {\n    let url = getBaseUrl('sources');\n    url = `${url}${category ? `&category=${category}` : ''}${language ? `&language=${language}` : ''}${country ? `&country=${country}` : ''}`\n    return cachedFetch(url)\n        .then(res => res.json())\n        .then(res => res.sources)\n        .catch(error => error)\n}\n\nfunction searchAllArticles(query: NewsQuery, pageSize: number, page: number, sortOrder?: SortOrder): Promise<ArticleResponse> {\n    let url = getBaseUrl('everything')\n    url = `${url}${getKeywordString(query)}`\n\n    return cachedFetch(url)\n    .then(res => res.json())\n    .then(articles => articles)\n    .catch(error => {console.log(error); throw error})\n}\n\nfunction searchTopHeadlines(query: HeadlineQuery, pageSize: number, page: number): Promise<ArticleResponse> {\n    const {category, language, country, sources} = query;\n    let url = getBaseUrl('top-headlines')\n    if (sources.length > 0) {\n        url = `${url}&sources=${sources.join(',')}`\n    } else {\n        url = `${url}${category ? `&category=${category}` : ''}&country=${country ? country : defualtHeadlineCountry}`\n    }\n    url = `${url}${language ? `&language=${language}` : ''}`\n    url = `${url}${getKeywordString(query)}`\n    url = url.replace('&', '')\n\n    return cachedFetch(url)\n    .then(res => res.json())\n    .then(sources => sources)\n    .catch(error => error)\n}\n\nfunction getKeywordString(query: NewsQuery | HeadlineQuery): string {\n    let requiredKeywords = query.requiredKeywords.join('AND');\n    let optionalKeywords = query.optionalKeywords.join('OR');\n    let excludedKeywords = query.excludedKeywords.join('NOT');\n\n    if (requiredKeywords === '' && optionalKeywords === '' && excludedKeywords === '') return ''\n    return encodeURI(`&q=${requiredKeywords}${optionalKeywords}${excludedKeywords}`)\n}\n\nfunction cachedFetch(url: string): Promise<Response> {\n    let cached = checkCache(url);\n    if (cached) return Promise.resolve(cached)\n\n    return fetch(\n        url, \n        { \n            headers: { \n                'Authorization': `Bearer ${process.env.REACT_APP_NEWSAPI_KEY}` \n            } \n        })\n        .then(res => {\n            if (res.ok) cacheRequest(url, res);\n            return res;\n        })\n}\n\nfunction checkCache(url: string): Response | undefined {\n    const cached = localStorage.getItem(url);\n    \n    if (cached) {\n        let parsed: CachedRequest = JSON.parse(cached);\n        if (new Date().getTime() > parsed.expiry) {\n            localStorage.removeItem(url)\n        } else {\n            return new Response(new Blob([parsed.response]));\n        }\n    }\n\n    return undefined;\n}\n\nfunction cacheRequest(url: string, response: Response) {\n    response.clone().text().then(data => {\n        let responseData: CachedRequest = {\n            response: data,\n            expiry: new Date().getTime() + CACHE_TIME\n        }\n        localStorage.setItem(url, JSON.stringify(responseData))\n    });\n}"]},"metadata":{},"sourceType":"module"}